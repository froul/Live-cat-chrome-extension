(()=>{"use strict";var e={214:e=>{class t extends Error{constructor(e){super(t._prepareSuperMessage(e)),Object.defineProperty(this,"name",{value:"NonError",configurable:!0,writable:!0}),Error.captureStackTrace&&Error.captureStackTrace(this,t)}static _prepareSuperMessage(e){try{return JSON.stringify(e)}catch(t){return String(e)}}}const r=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],n=({from:e,seen:t,to_:o,forceEnumerable:s})=>{const i=o||(Array.isArray(e)?[]:{});t.push(e);for(const[r,o]of Object.entries(e))"function"!=typeof o&&(o&&"object"==typeof o?t.includes(e[r])?i[r]="[Circular]":i[r]=n({from:e[r],seen:t.slice(),forceEnumerable:s}):i[r]=o);for(const{property:t,enumerable:n}of r)"string"==typeof e[t]&&Object.defineProperty(i,t,{value:e[t],enumerable:!!s||n,configurable:!0,writable:!0});return i};e.exports={serializeError:e=>"object"==typeof e&&null!==e?n({from:e,seen:[],forceEnumerable:!0}):"function"==typeof e?`[Function: ${e.name||"anonymous"}]`:e,deserializeError:e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e&&!Array.isArray(e)){const t=new Error;return n({from:e,seen:[],to_:t}),t}return new t(e)}}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{const e={IS_USERSCRIPT:!1,IS_FIREFOX:!1,IS_CHROME:!0,IS_V2:!1,IS_V3:!0,BROWSER:"chrome",geckoId:"{e7b1fc1c-aad2-4f76-8f35-4ee8702b89e9}"};e.IS_FIREFOX&&"undefined"==typeof chrome&&(r.g.chrome=browser);var t=r(214),n=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};const o=()=>{},s=new WeakMap;class i extends Error{constructor(e,t){super(e),this.code=t}}const a=i;var c=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};const u=new Map;let l=0;const f=(e,t=[])=>{l>1e5&&(l=0);let r,n=0;for(;0===n||u.has(n);)n=++l;const o=new Promise((e=>{r=e}));return u.set(n,{initFn:e,onInit:r,whenInit:o}),{id:n,methods:t}},h=e=>{const t=b(e);let r=null;try{t.init=t.initFn(),t.onInit()}catch(e){r=e,t.onInit(Promise.reject(new a("call initFn error","CALL_INIT_FN_ERROR")))}if(t.initFn=t.onInit=void 0,c(void 0,void 0,void 0,(function*(){try{yield t.init}catch(e){}finally{u.delete(e)}})),r)throw r;return t.init},d=(e,t,r=[])=>{const n=b(e);return n.whenInit.then((()=>{const{scope:e,endPoint:o}=function(e,t){const r=t.split("."),n=r.pop();let o=e;for(;r.length;)o=o[r.shift()];return{scope:o,endPoint:n}}(n.init,t);return e[o].apply(e,r)}))},p=e=>{u.delete(e)};function y(e,t,r){for(let n=0,o="";o=t[n];n++)e.resultPromise.hasOwnProperty(o)||(e.resultPromise[o]=(...t)=>e.whenInit.then((()=>{if(!e.id)throw new a("Instance is done","INSTANCE_DONE");return r.apiCall(r.instanceCallFn,{id:e.id,path:o,args:t})})))}function b(e){const t=u.get(e);if(!t)throw new a("Instance is not found","INSTANCE_IS_NOT_FOUND");return t}const m=e=>new Promise(((t,r)=>{chrome.runtime.sendMessage(e,(e=>{const n=chrome.runtime.lastError;n?r(n):t(e)}))})).then((e=>{if(!e)throw new Error("Response is empty");if("error"in e)throw Object.assign(new Error,e.error);return e.result})),w=e=>new Promise((t=>t(e()))),v=e=>[t=>w(e).then((()=>t)),t=>w(e).then((()=>{throw t}))];class g{constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}addEventListener(e,t,r){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:r})}removeEventListener(e,t){if(!(e in this.listeners))return;const r=this.listeners[e];for(let e=0,n=r.length;e<n;e++)if(r[e].callback===t)return void r.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;const t=this.listeners[e.type].slice();for(let r=0,n=t.length;r<n;r++){const n=t[r];try{n.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}n.options&&n.options.once&&this.removeEventListener(e.type,n.callback)}return!e.defaultPrevented}}class E extends g{constructor(){super(),this.listeners||g.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}}class I{constructor(){Object.defineProperty(this,"signal",{value:new E,writable:!0,configurable:!0})}abort(e){let t;try{t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let r=e;if(void 0===r)if("undefined"==typeof document)r=new Error("This operation was aborted"),r.name="AbortError";else try{r=new DOMException("signal is aborted without reason")}catch(e){r=new Error("This operation was aborted"),r.name="AbortError"}this.signal.reason=r,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}}const S=I;"undefined"!=typeof Symbol&&Symbol.toStringTag&&(I.prototype[Symbol.toStringTag]="AbortController",E.prototype[Symbol.toStringTag]="AbortSignal"),function(e){(function(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController})(e)&&(e.AbortController=S,e.AbortSignal=E)}("undefined"!=typeof self?self:r.g);var T="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==T&&T,_={searchParams:"URLSearchParams"in T,iterable:"Symbol"in T&&"iterator"in Symbol,blob:"FileReader"in T&&"Blob"in T&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in T,arrayBuffer:"ArrayBuffer"in T};if(_.arrayBuffer)var P=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],R=ArrayBuffer.isView||function(e){return e&&P.indexOf(Object.prototype.toString.call(e))>-1};function A(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function O(e){return"string"!=typeof e&&(e=String(e)),e}function x(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return _.iterable&&(t[Symbol.iterator]=function(){return t}),t}function C(e){this.map={},e instanceof C?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function B(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function j(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function U(e){var t=new FileReader,r=j(t);return t.readAsArrayBuffer(e),r}function F(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function L(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:_.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:_.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:_.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():_.arrayBuffer&&_.blob&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=F(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):_.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||R(e))?this._bodyArrayBuffer=F(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):_.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},_.blob&&(this.blob=function(){var e=B(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?B(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)):this.blob().then(U)}),this.text=function(){var e,t,r,n=B(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=j(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},_.formData&&(this.formData=function(){return this.text().then(N)}),this.json=function(){return this.text().then(JSON.parse)},this}C.prototype.append=function(e,t){e=A(e),t=O(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},C.prototype.delete=function(e){delete this.map[A(e)]},C.prototype.get=function(e){return e=A(e),this.has(e)?this.map[e]:null},C.prototype.has=function(e){return this.map.hasOwnProperty(A(e))},C.prototype.set=function(e,t){this.map[A(e)]=O(t)},C.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},C.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),x(e)},C.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),x(e)},C.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),x(e)},_.iterable&&(C.prototype[Symbol.iterator]=C.prototype.entries);var k=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function M(e,t){if(!(this instanceof M))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,o=(t=t||{}).body;if(e instanceof M){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new C(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new C(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),k.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(o),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var s=/([?&])_=[^&]*/;s.test(this.url)?this.url=this.url.replace(s,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function N(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function D(e,t){if(!(this instanceof D))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new C(t.headers),this.url=t.url||"",this._initBody(e)}M.prototype.clone=function(){return new M(this,{body:this._bodyInit})},L.call(M.prototype),L.call(D.prototype),D.prototype.clone=function(){return new D(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new C(this.headers),url:this.url})},D.error=function(){var e=new D(null,{status:0,statusText:""});return e.type="error",e};var q=[301,302,303,307,308];D.redirect=function(e,t){if(-1===q.indexOf(t))throw new RangeError("Invalid status code");return new D(null,{status:t,headers:{location:e}})};var H=T.DOMException;try{new H}catch(e){(H=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),H.prototype.constructor=H}function G(e,t){return new Promise((function(r,n){var o=new M(e,t);if(o.signal&&o.signal.aborted)return n(new H("Aborted","AbortError"));var s=new XMLHttpRequest;function i(){s.abort()}s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new C,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var o="response"in s?s.response:s.responseText;setTimeout((function(){r(new D(o,n))}),0)},s.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},s.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},s.onabort=function(){setTimeout((function(){n(new H("Aborted","AbortError"))}),0)},s.open(o.method,function(e){try{return""===e&&T.location.href?T.location.href:e}catch(t){return e}}(o.url),!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&(_.blob?s.responseType="blob":_.arrayBuffer&&o.headers.get("Content-Type")&&-1!==o.headers.get("Content-Type").indexOf("application/octet-stream")&&(s.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof C?o.headers.forEach((function(e,t){s.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){s.setRequestHeader(e,O(t.headers[e]))})),o.signal&&(o.signal.addEventListener("abort",i),s.onreadystatechange=function(){4===s.readyState&&o.signal.removeEventListener("abort",i)}),s.send(void 0===o._bodyInit?null:o._bodyInit)}))}function z(e){const t=new Uint8Array(e),r=new Array(t.length);for(let e=0;e<t.length;e++)r[e]=String.fromCharCode(t[e]);return r.join("")}G.polyfill=!0,T.fetch||(T.fetch=G,T.Headers=C,T.Request=M,T.Response=D);const V=(e,t)=>{const{signal:r}=t;return new Promise(((n,o)=>{if(r&&r.aborted)return o(new DOMException("Aborted","AbortError"));let s,i;const a=new Promise(((e,t)=>{i=e,s=e=>{(c||"AbortError"!==e.name)&&t(e)}}));let c=!1;const u={url:void 0,status:void 0,ok:void 0,statusText:void 0,headers:void 0,arrayBuffer:()=>(c=!0,a),text:()=>u.arrayBuffer().then(z),json:()=>u.text().then(JSON.parse),blob:()=>u.arrayBuffer().then((e=>new Blob([e])))},l=(f={method:t.method||"GET",url:e,headers:t.headers,data:t.body,responseType:"arraybuffer",onload(e){i(e.response)},onerror(){o(new TypeError("Network request failed"))},ontimeout(){o(new TypeError("Network request failed"))},onabort(){o(new DOMException("Aborted","AbortError"))},onreadystatechange(e){2===e.readyState&&(u.url=e.finalUrl,u.status=e.status,u.ok=u.status>=200&&u.status<300,u.statusText=e.statusText,u.headers=function(e){const t=e.split(/\r?\n/),r=new Headers;return t.forEach((e=>{const t=e.indexOf(":");if(-1===t)return;const n=e.substr(0,t).trim(),o=e.substr(t+1).trim();r.append(n,o)})),r}(e.responseHeaders),o=s,n(u))}},"function"==typeof GM_xmlhttpRequest?GM_xmlhttpRequest(f):GM.xmlHttpRequest(f));var f;r&&r.addEventListener("abort",(()=>{l.abort()}))}))},X=function(){return e.IS_USERSCRIPT?V:AbortController===I?G:fetch},J=X();function $(e){return e()||(()=>{})}function W(t){return e.IS_USERSCRIPT?t:function(e){const{fromCharCode:t}=String,r=new Uint8Array(e),n=r.byteLength;let o=[];for(let e=0;e<n;e+=1e4){const n=r.subarray(e,e+1e4);o.push(t.apply(null,n))}return o.join("")}(t)}const Y=(t,r,n={})=>{const o=f((()=>{s();const o=new AbortController;let i;const a=new Promise((e=>{i=e}));o.signal.addEventListener("abort",(()=>{i()}));let c=null,u=null;const l=()=>{o.abort()};a.then(...v($((()=>{function e(){o.abort()}return t.once("close",e),()=>{t.off("close",e)}}))));const h=Object.assign(a,{abort:l,getReaderInstance:()=>c.then((r=>(u&&u(),i(),function(t,r,n){const o=f((()=>{let o;s();const i=new Promise((e=>{o=e}));n.signal.addEventListener("abort",(()=>{o()}));const a={blob:null,arrayBuffer:null,done:!1};let c;if(e.IS_USERSCRIPT||"function"!=typeof ReadableStream){let e=null;c=t=>(e||(e=r.blob().then((e=>{a.blob=e,a.done=!0}))),e.then((()=>function(e,t,r){const{blob:n,done:o}=e,s=n;if(0===s.size&&o)return r(),{done:!0};const i=s.slice(0,t);return e.blob=s.slice(t),new Response(i).arrayBuffer().then((e=>({done:!1,value:W(e)})))}(a,t,o))))}else{let e=null;c=t=>(e||(e=r.body.getReader(),a.arrayBuffer=new ArrayBuffer(0)),function(e,t,r){const{arrayBuffer:n,done:o}=t;let s=n.byteLength;const i=[n],a=()=>{if(!(o||s>=r))return e.read().then((({done:e,value:r})=>{if(e)return void(t.done=!0);const n=r.buffer;return s+=n.byteLength,i.push(n),a()}))};return w(a).then((()=>{i.length>1&&(t.arrayBuffer=function(e,t){const r=new Uint8Array(t);let n,o=0;for(;e.length;)n=e.shift(),r.set(new Uint8Array(n),o),o+=n.byteLength;return r.buffer}(i,s))}))}(e,a,t).then((()=>function(e,t,r){const{arrayBuffer:n,done:o}=e,s=n;if(0===s.byteLength&&o)return r(),{done:!0};const i=s.slice(0,t);return e.arrayBuffer=s.slice(t),{done:!1,value:W(i)}}(a,t,o))))}const u=c;return i.then(...v($((()=>{function e(){n.abort()}return t.once("close",e),()=>{t.off("close",e)}})))),Object.assign(i,{read:u,abort:()=>{n.abort()}})}),["read","abort"]),s=$((()=>{const e=setTimeout(r,5e3);function r(){n.abort(),p(o.id)}return t.once("close",r),()=>{clearTimeout(e),t.off("close",r)}}));return o}(t,r,o)))),init:()=>(c=J(r,Object.assign(Object.assign({},n),{signal:o.signal})),c.then((e=>(u=$((()=>{const e=setTimeout((function(){l()}),5e3);return()=>{clearTimeout(e)}})),function(e){const t={};["ok","redirected","status","statusText","type","url"].forEach((r=>{t[r]=e[r]}));const r={};return e.headers.forEach(((e,t)=>{r[t]=e})),t.headers=r,t}(e)))))});return h}),["init","getReaderInstance","abort"]),s=$((()=>{function e(){p(o.id)}return t.once("close",e),()=>{t.off("close",e)}}));return o};function K(e,t){const r=new Uint8Array(t);let n,o=0;for(;e.length;)n=e.shift(),r.set(new Uint8Array(n),o),o+=n.byteLength;return r.buffer}var Q=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};const Z=X();class ee{constructor(e=4194304){this.chunkSize=e,this.abortController=new AbortController,this.done=!1}open(t,r){return Q(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},r),{signal:this.abortController.signal}),o=yield Z(t,n);let s;if(!e.IS_USERSCRIPT&&o.body&&"function"==typeof ReadableStream)s=o.body.getReader();else{let e;s={read:()=>Q(this,void 0,void 0,(function*(){e||(e=yield o.blob());const{nextBlob:t,done:r,value:n}=yield function(e,t){return r=this,n=void 0,s=function*(){if(0===e.size)return{nextBlob:e,done:!0};const r=e.slice(0,t);return{nextBlob:e.slice(t),done:!1,value:yield new Response(r).arrayBuffer()}},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(i,a)}c((s=s.apply(r,n||[])).next())}));var r,n,o,s}(e,this.chunkSize);return e=t,{done:r,value:n}}))}}return this.reader=s,function(e){const{ok:t,redirected:r,status:n,statusText:o,type:s,url:i}=e;return{ok:t,redirected:r,status:n,statusText:o,type:s,url:i,headers:function(e){const t={};return e.forEach(((e,r)=>{const n=t[r];n?"string"==typeof n?t[r]=[n]:n.push(e):t[r]=e})),t}(e.headers)}}(o)}))}read(){return Q(this,void 0,void 0,(function*(){if(!this.reader)throw new Error("Reader is not exists");if(this.done)return{done:!0};let t=0;const r=[];for(;!this.done&&t<this.chunkSize;){const{done:e,value:n}=yield this.reader.read();if(e){this.done=!0;break}void 0!==n&&(r.push(n),t+=n.byteLength)}return{done:!1,value:(n=K(r,t),e.IS_USERSCRIPT?n:function(e){const{fromCharCode:t}=String,r=new Uint8Array(e),n=r.byteLength;let o=[];for(let e=0;e<n;e+=1e4){const n=r.subarray(e,e+1e4);o.push(t.apply(null,n))}return o.join("")}(n))};var n}))}abort(){this.abortController.abort()}}var te=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};const re=new Map;function ne(e,t,r){return new Promise(((n,o)=>te(this,void 0,void 0,(function*(){try{n(yield r())}catch(r){e.delete(t),o(r)}}))))}!e.IS_USERSCRIPT&&((e,t,r=[])=>{let n;e.instanceInit=e.instanceInit||"instanceInit",e.instanceCallFn=e.instanceCallFn||"instanceCallFn";const o={id:null,whenInit:new Promise((e=>{n=e}))};return o.resultPromise=c(void 0,void 0,void 0,(function*(){return t()})).then((({id:t,methods:r})=>{o.id=t;const s=e.apiCall(e.instanceInit,{id:t});return s.then((()=>{o.id=null}),(e=>{o.id=null})),y(o,r,e),n(),s}),(e=>{throw n(Promise.reject(new a("Init remote instance error","INIT_REMOTE_INSTANCE_ERROR"))),e})),y(o,r,e),o.resultPromise}).bind(null,{apiCall:(e,t)=>m({action:e,options:t})});const oe={once:()=>{},off:()=>{}},se={mf:({type:t,data:r})=>e.IS_USERSCRIPT?function(e,t,r){if(!re.has(e)){const t=new Map;re.set(e,t),e.once("close",(()=>{t.forEach((e=>e.abort())),t.clear(),re.delete(e)}))}const n=re.get(e);switch(t){case"open":{const{id:e,url:t,options:o,chunkSize:s}=r;return ne(n,e,(()=>te(this,void 0,void 0,(function*(){if(n.has(e))throw new Error("MF already exists");const r=new ee(s);return n.set(e,r),r.open(t,o)}))))}case"read":{const{id:e}=r;return ne(n,e,(()=>te(this,void 0,void 0,(function*(){const t=n.get(e);if(!t)throw new Error("MF is not exists");const r=yield t.read();return r.done&&n.delete(e),r}))))}case"abort":{const{id:e}=r,t=n.get(e);n.delete(e),t&&t.abort()}}}(oe,t,r):m({action:"mf",type:t,data:r}),remoteFetch:({url:t,options:r})=>e.IS_USERSCRIPT?Y({once:()=>{},off:()=>{}},t,r):m({action:"remoteFetch",url:t,options:r}),_instanceInit(t){if(e.IS_USERSCRIPT){const{id:e}=t;return h(e)}return m({action:"instanceInit",options:t})},_instanceCallFn(t){if(e.IS_USERSCRIPT){const{id:e,path:r,args:n}=t;return d(e,r,n)}return m({action:"instanceCallFn",options:t})},instanceInit:({id:e})=>h(e),instanceCallFn:({id:e,path:t,args:r})=>d(e,t,r),ping:()=>!0,addPowerLock(){if(!e.IS_USERSCRIPT)return m({action:"addPowerLock"})},removePowerLock(t){if(!e.IS_USERSCRIPT)return m({action:"removePowerLock",options:t})}};function ie(){if(!e.IS_USERSCRIPT)return chrome.runtime.getManifest().version;try{return("object"==typeof GM_info?GM_info:GM.info).script.version}catch(e){return null}}window.addEventListener("message",(({data:r,ports:[i]})=>{"EXTENSION_INIT"===r&&function(r){new class{constructor(e,t){this.transport=e,this.scope=t,this.pageId=Math.trunc(1e3*Math.random()),this.callbackId=0,this.callbackIdCallback={},this.listeners=[],this.listener=(e,t,r)=>{if("callFn"===e.action)return this.responseFn(e,r),!0},this.callFn=(e,t=[])=>this.waitPromise({action:"callFn",fn:e,args:t}),this.onMessage(this.listener)}onMessage(e){const t=this.listeners,r=this.callbackIdCallback;!t.length&&this.transport.onMessage(((e,n)=>{if(n.responseId){const e=r[n.responseId];return void(e?e(n.message):console.error("Callback is not found",n))}let s;s=n.callbackId?function(e){let t=!1;return function(){t||(t=!0,e.apply(null,arguments))}}((e=>{this.transport.sendMessage({responseId:n.callbackId,message:e})})):o;let i=null;t.forEach((t=>{try{const r=t(n.message,{event:e},s);!0===r&&(i=r)}catch(e){console.error("Call listener error",e)}})),!0!==i&&s()})),t.push(e)}sendMessage(e,t){const r=this.callbackIdCallback,n={message:e};if(t){n.callbackId=this.pageId+ ++this.callbackId;const e=e=>{delete r[n.callbackId],t(e)};s.has(t)&&(s.delete(t),s.set(e,!0)),r[n.callbackId]=e}try{this.transport.sendMessage(n)}catch(e){throw n.callbackId&&delete r[n.callbackId],e}}waitPromise(e){return new Promise(((r,n)=>{const o=e=>e.err?n((0,t.deserializeError)(e.err)):r(e.result);s.set(o,!0),this.sendMessage(e,o)}))}responsePromise(e,r){return e.then((e=>{r({result:e})}),(e=>{r({err:(0,t.serializeError)(e)})})).catch((function(e){console.error("responsePromise error",e)})),!0}resolvePath(e){const t=e.split("."),r=t.pop();let n=this.scope;for(;t.length;)n=n[t.shift()];return{scope:n,endPoint:r}}responseFn(e,t){return n(this,void 0,void 0,(function*(){const r=(()=>n(this,void 0,void 0,(function*(){const{scope:t,endPoint:r}=this.resolvePath(e.fn);return t[r].apply(t,e.args)})))();return this.responsePromise(r,t)}))}}({onMessage:e=>{r.onmessage=t=>e(t,t.data)},sendMessage:e=>r.postMessage(e)},se).callFn("ready",[{version:ie(),hasRemoteFetch:!0,hasMyFetch:!0,hasPowerLock:!!e.IS_CHROME,isUserScript:!!e.IS_USERSCRIPT}])}(i)}))})()})();