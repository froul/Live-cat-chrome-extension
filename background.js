(()=>{var e={187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(r,n){function o(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),r([].slice.call(arguments))}y(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var o,i,s,u;if(a(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]),void 0===s)s=i[t]=r,++e._eventsCount;else if("function"==typeof s?s=i[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(o=c(e))>0&&s.length>o&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=l.bind(n);return o.listener=r,n.wrapFn=o,o}function h(e,t,r){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):p(o,o.length)}function d(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){n.once&&e.removeEventListener(t,o),r(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var u=c.length,l=p(c,u);for(r=0;r<u;++r)n(l[r],this,t)}return!0},i.prototype.addListener=function(e,t){return u(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return u(this,e,t,!0)},i.prototype.once=function(e,t){return a(t),this.on(e,f(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,f(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,o,i,s;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return h(this,e,!0)},i.prototype.rawListeners=function(e){return h(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},96:(e,t,r)=>{var n="Expected a function",o=NaN,i="[object Symbol]",s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt,f="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,h="object"==typeof self&&self&&self.Object===Object&&self,d=f||h||Function("return this")(),p=Object.prototype.toString,y=Math.max,b=Math.min,m=function(){return d.Date.now()};function v(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function g(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&p.call(e)==i}(e))return o;if(v(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=v(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var r=c.test(e);return r||u.test(e)?l(e.slice(2),r?2:8):a.test(e)?o:+e}e.exports=function(e,t,r){var o=!0,i=!0;if("function"!=typeof e)throw new TypeError(n);return v(r)&&(o="leading"in r?!!r.leading:o,i="trailing"in r?!!r.trailing:i),function(e,t,r){var o,i,s,a,c,u,l=0,f=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError(n);function p(t){var r=o,n=i;return o=i=void 0,l=t,a=e.apply(n,r)}function w(e){var r=e-u;return void 0===u||r>=t||r<0||h&&e-l>=s}function E(){var e=m();if(w(e))return _(e);c=setTimeout(E,function(e){var r=t-(e-u);return h?b(r,s-(e-l)):r}(e))}function _(e){return c=void 0,d&&o?p(e):(o=i=void 0,a)}function x(){var e=m(),r=w(e);if(o=arguments,i=this,u=e,r){if(void 0===c)return function(e){return l=e,c=setTimeout(E,t),f?p(e):a}(u);if(h)return c=setTimeout(E,t),p(u)}return void 0===c&&(c=setTimeout(E,t)),a}return t=g(t)||0,v(r)&&(f=!!r.leading,s=(h="maxWait"in r)?y(g(r.maxWait)||0,t):s,d="trailing"in r?!!r.trailing:d),x.cancel=function(){void 0!==c&&clearTimeout(c),l=0,o=u=i=c=void 0},x.flush=function(){return void 0===c?a:_(m())},x}(e,t,{leading:o,maxWait:t,trailing:i})}},567:(e,t,r)=>{"use strict";r.r(t),r.d(t,{NonError:()=>i,deserializeError:()=>f,errorConstructors:()=>o,isErrorLike:()=>h,serializeError:()=>l});const n=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map((e=>[e.name,e])),o=new Map(n);class i extends Error{name="NonError";constructor(e){super(i._prepareSuperMessage(e))}static _prepareSuperMessage(e){try{return JSON.stringify(e)}catch{return String(e)}}}const s=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],a=Symbol(".toJSON was called"),c=e=>o.get(e)??Error,u=({from:e,seen:t,to:r,forceEnumerable:n,maxDepth:o,depth:i,useToJSON:l,serialize:f})=>{if(r||(r=Array.isArray(e)?[]:!f&&h(e)?new(c(e.name)):{}),t.push(e),i>=o)return r;if(l&&"function"==typeof e.toJSON&&!0!==e[a])return(e=>{e[a]=!0;const t=e.toJSON();return delete e[a],t})(e);const d=e=>u({from:e,seen:[...t],forceEnumerable:n,maxDepth:o,depth:i,useToJSON:l,serialize:f});for(const[n,o]of Object.entries(e))"function"==typeof Buffer&&Buffer.isBuffer(o)?r[n]="[object Buffer]":null===o||"object"!=typeof o||"function"!=typeof o.pipe?"function"!=typeof o&&(o&&"object"==typeof o?t.includes(e[n])?r[n]="[Circular]":(i++,r[n]=d(e[n])):r[n]=o):r[n]="[object Stream]";for(const{property:t,enumerable:o}of s)void 0!==e[t]&&null!==e[t]&&Object.defineProperty(r,t,{value:h(e[t])?d(e[t]):e[t],enumerable:!!n||o,configurable:!0,writable:!0});return r};function l(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:n=!0}=t;return"object"==typeof e&&null!==e?u({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:n,serialize:!0}):"function"==typeof e?`[Function: ${e.name??"anonymous"}]`:e}function f(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=t;if(e instanceof Error)return e;if(function(e){return Boolean(e)&&"object"==typeof e&&"message"in e&&!Array.isArray(e)}(e)){const t=c(e.name);return u({from:e,seen:[],to:new t,maxDepth:r,depth:0,serialize:!1})}return new i(e)}function h(e){return Boolean(e)&&"object"==typeof e&&"name"in e&&"message"in e&&"stack"in e}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";const e={IS_USERSCRIPT:!1,IS_FIREFOX:!1,IS_CHROME:!0,IS_V2:!1,IS_V3:!0,BROWSER:"chrome",geckoId:"{e7b1fc1c-aad2-4f76-8f35-4ee8702b89e9}"};e.IS_FIREFOX&&"undefined"==typeof chrome&&(r.g.chrome=browser);class t extends Error{constructor(e,t){super(e),this.code=t}}const n=t;const o=new Map;let i=0;const s=(e,t=[])=>{i>1e5&&(i=0);let r,n=0;for(;0===n||o.has(n);)n=++i;const s=new Promise((e=>{r=e}));return o.set(n,{initFn:e,onInit:r,whenInit:s}),{id:n,methods:t}},a=e=>{o.delete(e)};function c(e){const t=o.get(e);if(!t)throw new n("Instance is not found","INSTANCE_IS_NOT_FOUND");return t}const u=e=>new Promise((t=>t(e())));var l=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};function f(e){return l(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{chrome.tabs.query(e,(e=>{const n=chrome.runtime.lastError;n?r(n):t(e)}))}))}))}const h=r(187),d=class extends h{constructor(e){super(),this.id=e,this.urlRequest=new Map,this.requests=[],this.patchLine=new class{constructor(e){this.tab=e,this.handlePath=e=>{this.patchLine.push(e),this.idLine.push(this.patchId),this.timeLine.push(Date.now()),this.callClean()},this.cleanTimeoutId=null,this.id=Math.trunc(1e3*Math.random()),this.patchLine=[],this.timeLine=[],this.idLine=[],this.index=0}get patchId(){this.index>1e9&&(this.index=0);let e=-1;for(;-1===e||-1!==this.idLine.indexOf(e);)e=++this.index;return e}get lastPatchId(){return this.idLine[this.idLine.length-1]||null}getDelta(e,t){const r=this.lastPatchId;try{if(e!==this.id)throw new n("store id is not equal","ID_IS_NOT_EQUAL");return{id:this.id,patchId:r,type:"patch",result:this.getPatchAfterId(t)}}catch(e){if(-1!==["ID_IS_NOT_EQUAL","PATCH_ID_IS_NOT_FOUND"].indexOf(e.code))return{id:this.id,patchId:r,type:"snapshot",result:this.getSnapshot()};throw e}}getSnapshot(){return this.tab.requests}getPatchAfterId(e){if(this.lastPatchId===e)return[];const t=this.idLine.indexOf(e);if(-1===t)throw new n("Patch is is not found","PATCH_ID_IS_NOT_FOUND");return this.patchLine.slice(t+1)}callClean(){null===this.cleanTimeoutId&&(this.cleanTimeoutId=setTimeout((()=>{this.cleanTimeoutId=null,this.clean()}),1e3))}clean(){const e=Date.now()-6e4;let t=-1;for(let r=0;r<this.timeLine.length&&this.timeLine[r]<e;r++)t=r;-1!==t&&(this.patchLine.splice(0,t+1),this.idLine.splice(0,t+1),this.timeLine.splice(0,t+1))}reset(){this.patchLine.splice(0),this.idLine.splice(0),this.timeLine.splice(0)}}(this),this.title="",this.setMaxListeners(100)}addRequest(e){this.urlRequest.has(e.url)||(this.requests.unshift(e),this.urlRequest.set(e.url,e),this.patchLine.handlePath({op:"unshift",value:e}),this.updateBadge())}reset(){this.requests.splice(0),this.urlRequest.clear(),this.patchLine.reset(),this.updateBadge()}updateBadge(){return t=this,r=void 0,o=function*(){const t=this.requests.length;let r="";t>99?r="99+":t&&(r=""+t),yield function(t){return l(this,void 0,void 0,(function*(){e.IS_V2?yield new Promise(((e,r)=>{chrome.browserAction.setBadgeText(t,(()=>{const t=chrome.runtime.lastError;t?r(t):e()}))})):yield chrome.action.setBadgeText(t)}))}({text:r,tabId:this.id})},new((n=void 0)||(n=Promise))((function(e,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(s,a)}c((o=o.apply(t,r||[])).next())}));var t,r,n,o}reload(){this.emit("close")}close(){this.emit("close")}serialize(){return{requests:this.requests.slice(0,100)}}deSerialize({requests:e}){e.reverse().forEach((e=>this.addRequest(e)))}};let p=1;const y={ids:[],addLock(){const e=p++;return this.ids.push(e),1===this.ids.length&&chrome.power.requestKeepAwake("system"),e},removeLock(e){const t=this.ids.indexOf(e);-1!==t&&(this.ids.splice(t,1),this.ids.length||chrome.power.releaseKeepAwake())}},b=e=>[t=>u(e).then((()=>t)),t=>u(e).then((()=>{throw t}))];class m{constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}addEventListener(e,t,r){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:r})}removeEventListener(e,t){if(!(e in this.listeners))return;const r=this.listeners[e];for(let e=0,n=r.length;e<n;e++)if(r[e].callback===t)return void r.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;const t=this.listeners[e.type].slice();for(let r=0,n=t.length;r<n;r++){const n=t[r];try{n.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}n.options&&n.options.once&&this.removeEventListener(e.type,n.callback)}return!e.defaultPrevented}}class v extends m{constructor(){super(),this.listeners||m.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}}class g{constructor(){Object.defineProperty(this,"signal",{value:new v,writable:!0,configurable:!0})}abort(e){let t;try{t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let r=e;if(void 0===r)if("undefined"==typeof document)r=new Error("This operation was aborted"),r.name="AbortError";else try{r=new DOMException("signal is aborted without reason")}catch(e){r=new Error("This operation was aborted"),r.name="AbortError"}this.signal.reason=r,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}}const w=g;"undefined"!=typeof Symbol&&Symbol.toStringTag&&(g.prototype[Symbol.toStringTag]="AbortController",v.prototype[Symbol.toStringTag]="AbortSignal"),function(e){(function(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController})(e)&&(e.AbortController=w,e.AbortSignal=v)}("undefined"!=typeof self?self:r.g);var E="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==E&&E,_={searchParams:"URLSearchParams"in E,iterable:"Symbol"in E&&"iterator"in Symbol,blob:"FileReader"in E&&"Blob"in E&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in E,arrayBuffer:"ArrayBuffer"in E};if(_.arrayBuffer)var x=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],T=ArrayBuffer.isView||function(e){return e&&x.indexOf(Object.prototype.toString.call(e))>-1};function L(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function O(e){return"string"!=typeof e&&(e=String(e)),e}function S(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return _.iterable&&(t[Symbol.iterator]=function(){return t}),t}function I(e){this.map={},e instanceof I?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function A(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function P(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function R(e){var t=new FileReader,r=P(t);return t.readAsArrayBuffer(e),r}function j(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function B(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:_.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:_.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:_.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():_.arrayBuffer&&_.blob&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=j(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):_.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||T(e))?this._bodyArrayBuffer=j(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):_.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},_.blob&&(this.blob=function(){var e=A(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?A(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)):this.blob().then(R)}),this.text=function(){var e,t,r,n=A(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=P(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},_.formData&&(this.formData=function(){return this.text().then(N)}),this.json=function(){return this.text().then(JSON.parse)},this}I.prototype.append=function(e,t){e=L(e),t=O(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},I.prototype.delete=function(e){delete this.map[L(e)]},I.prototype.get=function(e){return e=L(e),this.has(e)?this.map[e]:null},I.prototype.has=function(e){return this.map.hasOwnProperty(L(e))},I.prototype.set=function(e,t){this.map[L(e)]=O(t)},I.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},I.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),S(e)},I.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),S(e)},I.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),S(e)},_.iterable&&(I.prototype[Symbol.iterator]=I.prototype.entries);var C=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function U(e,t){if(!(this instanceof U))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,o=(t=t||{}).body;if(e instanceof U){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new I(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new I(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),C.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(o),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var i=/([?&])_=[^&]*/;i.test(this.url)?this.url=this.url.replace(i,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function N(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function F(e,t){if(!(this instanceof F))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new I(t.headers),this.url=t.url||"",this._initBody(e)}U.prototype.clone=function(){return new U(this,{body:this._bodyInit})},B.call(U.prototype),B.call(F.prototype),F.prototype.clone=function(){return new F(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new I(this.headers),url:this.url})},F.error=function(){var e=new F(null,{status:0,statusText:""});return e.type="error",e};var D=[301,302,303,307,308];F.redirect=function(e,t){if(-1===D.indexOf(t))throw new RangeError("Invalid status code");return new F(null,{status:t,headers:{location:e}})};var k=E.DOMException;try{new k}catch(e){(k=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),k.prototype.constructor=k}function M(e,t){return new Promise((function(r,n){var o=new U(e,t);if(o.signal&&o.signal.aborted)return n(new k("Aborted","AbortError"));var i=new XMLHttpRequest;function s(){i.abort()}i.onload=function(){var e,t,n={status:i.status,statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",t=new I,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};n.url="responseURL"in i?i.responseURL:n.headers.get("X-Request-URL");var o="response"in i?i.response:i.responseText;setTimeout((function(){r(new F(o,n))}),0)},i.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},i.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},i.onabort=function(){setTimeout((function(){n(new k("Aborted","AbortError"))}),0)},i.open(o.method,function(e){try{return""===e&&E.location.href?E.location.href:e}catch(t){return e}}(o.url),!0),"include"===o.credentials?i.withCredentials=!0:"omit"===o.credentials&&(i.withCredentials=!1),"responseType"in i&&(_.blob?i.responseType="blob":_.arrayBuffer&&o.headers.get("Content-Type")&&-1!==o.headers.get("Content-Type").indexOf("application/octet-stream")&&(i.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof I?o.headers.forEach((function(e,t){i.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){i.setRequestHeader(e,O(t.headers[e]))})),o.signal&&(o.signal.addEventListener("abort",s),i.onreadystatechange=function(){4===i.readyState&&o.signal.removeEventListener("abort",s)}),i.send(void 0===o._bodyInit?null:o._bodyInit)}))}function q(e){const t=new Uint8Array(e),r=new Array(t.length);for(let e=0;e<t.length;e++)r[e]=String.fromCharCode(t[e]);return r.join("")}M.polyfill=!0,E.fetch||(E.fetch=M,E.Headers=I,E.Request=U,E.Response=F);const z=(e,t)=>{const{signal:r}=t;return new Promise(((n,o)=>{if(r&&r.aborted)return o(new DOMException("Aborted","AbortError"));let i,s;const a=new Promise(((e,t)=>{s=e,i=e=>{(c||"AbortError"!==e.name)&&t(e)}}));let c=!1;const u={url:void 0,status:void 0,ok:void 0,statusText:void 0,headers:void 0,arrayBuffer:()=>(c=!0,a),text:()=>u.arrayBuffer().then(q),json:()=>u.text().then(JSON.parse),blob:()=>u.arrayBuffer().then((e=>new Blob([e])))},l=(f={method:t.method||"GET",url:e,headers:t.headers,data:t.body,responseType:"arraybuffer",onload(e){s(e.response)},onerror(){o(new TypeError("Network request failed"))},ontimeout(){o(new TypeError("Network request failed"))},onabort(){o(new DOMException("Aborted","AbortError"))},onreadystatechange(e){2===e.readyState&&(u.url=e.finalUrl,u.status=e.status,u.ok=u.status>=200&&u.status<300,u.statusText=e.statusText,u.headers=function(e){const t=e.split(/\r?\n/),r=new Headers;return t.forEach((e=>{const t=e.indexOf(":");if(-1===t)return;const n=e.substr(0,t).trim(),o=e.substr(t+1).trim();r.append(n,o)})),r}(e.responseHeaders),o=i,n(u))}},"function"==typeof GM_xmlhttpRequest?GM_xmlhttpRequest(f):GM.xmlHttpRequest(f));var f;r&&r.addEventListener("abort",(()=>{l.abort()}))}))},H=function(){return e.IS_USERSCRIPT?z:AbortController===g?M:fetch},G=H();function J(e){return e()||(()=>{})}function V(t){return e.IS_USERSCRIPT?t:function(e){const{fromCharCode:t}=String,r=new Uint8Array(e),n=r.byteLength;let o=[];for(let e=0;e<n;e+=1e4){const n=r.subarray(e,e+1e4);o.push(t.apply(null,n))}return o.join("")}(t)}const $=(t,r,n={})=>{const o=s((()=>{i();const o=new AbortController;let c;const l=new Promise((e=>{c=e}));o.signal.addEventListener("abort",(()=>{c()}));let f=null,h=null;const d=()=>{o.abort()};l.then(...b(J((()=>{function e(){o.abort()}return t.once("close",e),()=>{t.off("close",e)}}))));const p=Object.assign(l,{abort:d,getReaderInstance:()=>f.then((r=>(h&&h(),c(),function(t,r,n){const o=s((()=>{let o;i();const s=new Promise((e=>{o=e}));n.signal.addEventListener("abort",(()=>{o()}));const a={blob:null,arrayBuffer:null,done:!1};let c;if(e.IS_USERSCRIPT||"function"!=typeof ReadableStream){let e=null;c=t=>(e||(e=r.blob().then((e=>{a.blob=e,a.done=!0}))),e.then((()=>function(e,t,r){const{blob:n,done:o}=e,i=n;if(0===i.size&&o)return r(),{done:!0};const s=i.slice(0,t);return e.blob=i.slice(t),new Response(s).arrayBuffer().then((e=>({done:!1,value:V(e)})))}(a,t,o))))}else{let e=null;c=t=>(e||(e=r.body.getReader(),a.arrayBuffer=new ArrayBuffer(0)),function(e,t,r){const{arrayBuffer:n,done:o}=t;let i=n.byteLength;const s=[n],a=()=>{if(!(o||i>=r))return e.read().then((({done:e,value:r})=>{if(e)return void(t.done=!0);const n=r.buffer;return i+=n.byteLength,s.push(n),a()}))};return u(a).then((()=>{s.length>1&&(t.arrayBuffer=function(e,t){const r=new Uint8Array(t);let n,o=0;for(;e.length;)n=e.shift(),r.set(new Uint8Array(n),o),o+=n.byteLength;return r.buffer}(s,i))}))}(e,a,t).then((()=>function(e,t,r){const{arrayBuffer:n,done:o}=e,i=n;if(0===i.byteLength&&o)return r(),{done:!0};const s=i.slice(0,t);return e.arrayBuffer=i.slice(t),{done:!1,value:V(s)}}(a,t,o))))}const l=c;return s.then(...b(J((()=>{function e(){n.abort()}return t.once("close",e),()=>{t.off("close",e)}})))),Object.assign(s,{read:l,abort:()=>{n.abort()}})}),["read","abort"]),i=J((()=>{const e=setTimeout(r,5e3);function r(){n.abort(),a(o.id)}return t.once("close",r),()=>{clearTimeout(e),t.off("close",r)}}));return o}(t,r,o)))),init:()=>(f=G(r,Object.assign(Object.assign({},n),{signal:o.signal})),f.then((e=>(h=J((()=>{const e=setTimeout((function(){d()}),5e3);return()=>{clearTimeout(e)}})),function(e){const t={};["ok","redirected","status","statusText","type","url"].forEach((r=>{t[r]=e[r]}));const r={};return e.headers.forEach(((e,t)=>{r[t]=e})),t.headers=r,t}(e)))))});return p}),["init","getReaderInstance","abort"]),i=J((()=>{function e(){a(o.id)}return t.once("close",e),()=>{t.off("close",e)}}));return o};function W(e,t){const r=new Uint8Array(t);let n,o=0;for(;e.length;)n=e.shift(),r.set(new Uint8Array(n),o),o+=n.byteLength;return r.buffer}var K=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};const X=H();class Y{constructor(e=4194304){this.chunkSize=e,this.abortController=new AbortController,this.done=!1}open(t,r){return K(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},r),{signal:this.abortController.signal}),o=yield X(t,n);let i;if(!e.IS_USERSCRIPT&&o.body&&"function"==typeof ReadableStream)i=o.body.getReader();else{let e;i={read:()=>K(this,void 0,void 0,(function*(){e||(e=yield o.blob());const{nextBlob:t,done:r,value:n}=yield function(e,t){return r=this,n=void 0,i=function*(){if(0===e.size)return{nextBlob:e,done:!0};const r=e.slice(0,t);return{nextBlob:e.slice(t),done:!1,value:yield new Response(r).arrayBuffer()}},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(s,a)}c((i=i.apply(r,n||[])).next())}));var r,n,o,i}(e,this.chunkSize);return e=t,{done:r,value:n}}))}}return this.reader=i,function(e){const{ok:t,redirected:r,status:n,statusText:o,type:i,url:s}=e;return{ok:t,redirected:r,status:n,statusText:o,type:i,url:s,headers:function(e){const t={};return e.forEach(((e,r)=>{const n=t[r];n?"string"==typeof n?t[r]=[n]:n.push(e):t[r]=e})),t}(e.headers)}}(o)}))}read(){return K(this,void 0,void 0,(function*(){if(!this.reader)throw new Error("Reader is not exists");if(this.done)return{done:!0};let t=0;const r=[];for(;!this.done&&t<this.chunkSize;){const{done:e,value:n}=yield this.reader.read();if(e){this.done=!0;break}void 0!==n&&(r.push(n),t+=n.byteLength)}return{done:!1,value:(n=W(r,t),e.IS_USERSCRIPT?n:function(e){const{fromCharCode:t}=String,r=new Uint8Array(e),n=r.byteLength;let o=[];for(let e=0;e<n;e+=1e4){const n=r.subarray(e,e+1e4);o.push(t.apply(null,n))}return o.join("")}(n))};var n}))}abort(){this.abortController.abort()}}var Q=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};const Z=new Map;function ee(e,t,r){return new Promise(((n,o)=>Q(this,void 0,void 0,(function*(){try{n(yield r())}catch(r){e.delete(t),o(r)}}))))}var te=r(96),re=r.n(te),ne=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};const{serializeError:oe}=r(567),ie=new Map;function se(e,t){var r,i,s,a;switch(e.action){case"getChanges":return u((()=>void 0===e.tabId?f({active:!0,currentWindow:!0}).then((([e])=>null==e?void 0:e.id)):e.tabId)).then((t=>{const r={tabId:null,delta:null},n=ie.get(t);if(n){const{id:o,patchId:i}=e.session;r.tabId=t,r.delta=n.patchLine.getDelta(o,i)}return r}));case"clearRequests":{const{tabId:t}=e,r=ie.get(t);r&&(r.reset(),ce());break}case"reloadMe":(null===(r=t.tab)||void 0===r?void 0:r.id)&&chrome.tabs.reload(t.tab.id);break;case"remoteFetch":{if(!(null===(i=t.tab)||void 0===i?void 0:i.id))throw new Error("Tab is not exists");const r=ae(t.tab.id),{url:n,options:o}=e;return $(r,n,o)}case"mf":{if(!(null===(s=t.tab)||void 0===s?void 0:s.id))throw new Error("Tab is not exists");const r=ae(t.tab.id),{type:n,data:o}=e;return function(e,t,r){if(!Z.has(e)){const t=new Map;Z.set(e,t),e.once("close",(()=>{t.forEach((e=>e.abort())),t.clear(),Z.delete(e)}))}const n=Z.get(e);switch(t){case"open":{const{id:e,url:t,options:o,chunkSize:i}=r;return ee(n,e,(()=>Q(this,void 0,void 0,(function*(){if(n.has(e))throw new Error("MF already exists");const r=new Y(i);return n.set(e,r),r.open(t,o)}))))}case"read":{const{id:e}=r;return ee(n,e,(()=>Q(this,void 0,void 0,(function*(){const t=n.get(e);if(!t)throw new Error("MF is not exists");const r=yield t.read();return r.done&&n.delete(e),r}))))}case"abort":{const{id:e}=r,t=n.get(e);n.delete(e),t&&t.abort()}}}(r,n,o)}case"instanceInit":{const{id:t}=e.options;return(e=>{const t=c(e);let r=null;try{t.init=t.initFn(),t.onInit()}catch(e){r=e,t.onInit(Promise.reject(new n("call initFn error","CALL_INIT_FN_ERROR")))}if(t.initFn=t.onInit=void 0,i=void 0,s=void 0,u=function*(){try{yield t.init}catch(e){}finally{o.delete(e)}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof a?o:new a((function(e){e(o)}))).then(r,n)}o((u=u.apply(i,s||[])).next())})),r)throw r;var i,s,a,u;return t.init})(t)}case"instanceCallFn":{const{id:t,path:r,args:n}=e.options;return((e,t,r=[])=>{const n=c(e);return n.whenInit.then((()=>{const{scope:e,endPoint:o}=function(e,t){const r=t.split("."),n=r.pop();let o=e;for(;r.length;)o=o[r.shift()];return{scope:o,endPoint:n}}(n.init,t);return e[o].apply(e,r)}))})(t,r,n)}case"addPowerLock":{if(!(null===(a=t.tab)||void 0===a?void 0:a.id))throw new Error("Tab is not exists");const e=ae(t.tab.id),r=y.addLock();return e.once("close",(()=>{y.removeLock(r)})),r}case"removePowerLock":{const{id:t}=e.options;y.removeLock(t);break}}}function ae(e){let t=ie.get(e);return t||(t=new d(e),ie.set(e,t)),t}chrome.tabs.onCreated.addListener((e=>{const t=e.id;t&&(ae(t).title=e.title||"",ce())})),chrome.tabs.onUpdated.addListener(((e,t)=>{ie.has(e)&&t.title&&(ie.get(e).title=t.title,ce())})),chrome.tabs.onRemoved.addListener((e=>{const t=ie.get(e);t&&(t.close(),ie.delete(e))})),chrome.webRequest.onResponseStarted.addListener((e=>{const{url:t,method:r,type:n,statusCode:o,responseHeaders:i=[],tabId:s}=e;if("main_frame"===n){const e=ie.get(s);e&&(e.reset(),e.reload(),ce())}if(-1===s)return;if(o<200||o>400||204===o)return;if("GET"!==r)return;let a="";for(let e,r=0;e=i[r];r++){const{value:r="",name:n}=e;if("content-type"===n.toLowerCase()){/^application\/vnd\.apple\.mpegurl/i.test(r)?a="application/vnd.apple.mpegurl":/^application\/x-mpegURL|text\/x-mpegURL/i.test(r)?a="application/x-mpegURL":/^video\/vnd\.mpeg\.dash\.mpd/i.test(r)||/^text\/xml/i.test(r)&&/\.mpd($|\?)/.test(t)?a="video/vnd.mpeg.dash.mpd":/^application\/dash\+xml/i.test(r)&&(a="application/dash+xml");break}}if(!a)return;const c=ae(s);"main_frame"===n&&(c.url=t),c.addRequest({url:t,mimeType:a,title:c.title}),ce()}),{urls:["<all_urls>"]},["responseHeaders"]),chrome.runtime.onMessage.addListener(((e,t,r)=>{if(e&&e.action)return u((()=>se(e,t))).then((e=>{r({result:e})}),(e=>{r({error:oe(e)})})).catch((e=>{console.error("Send response error",e)})),!0}));const ce=re()((function(){return ne(this,void 0,void 0,(function*(){if(!e.IS_V3)return;const t={};ie.forEach(((e,r)=>{t[r]=e.serialize()})),yield chrome.storage.session.set({state:t})}))}),1e4,{leading:!1});ne(void 0,void 0,void 0,(function*(){(yield f({url:["*://mediatools.cc/*","*://mediatools.rndnm.com/*"]})).forEach((e=>{e.id&&chrome.tabs.executeScript(e.id,{code:"("+function(){/\/extensionWatcher\.html/.test(location.href)&&chrome.runtime.sendMessage({action:"reloadMe"})}.toString()+")()",allFrames:!0})}))})),ne(void 0,void 0,void 0,(function*(){if(!e.IS_V3)return;const[t,{state:r}]=yield Promise.all([f({}),chrome.storage.session.get({state:{}})]);t.forEach((({id:e})=>{if(!e)return;const t=r[e];t&&ae(e).deSerialize(t)}))}))})()})();